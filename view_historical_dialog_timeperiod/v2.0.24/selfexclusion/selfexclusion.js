define(["jquery","windows/windows","websockets/binary_websockets","lodash","common/rivetsExtra","jquery-growl"],function(a,b,c,d,e){var f=null,g={max_balance:null,max_turnover:null,max_losses:null,max_7day_turnover:null,max_7day_losses:null,max_30day_turnover:null,max_30day_losses:null,max_open_bets:null,session_duration_limit:null,exclude_until:null,update:function(b,e){var f={set_self_exclusion:1,session_duration_limit:e.session_duration_limit,exclude_until:e.exclude_until,max_open_bets:e.max_open_bets,max_balance:e.max_balance,max_30day_losses:e.max_30day_losses,max_turnover:e.max_turnover,max_30day_turnover:e.max_30day_turnover,max_7day_losses:e.max_7day_losses,max_losses:e.max_losses,max_7day_turnover:e.max_7day_turnover};return d.isNumber(f.session_duration_limit)?d.isNumber(f.max_open_bets)?d.isNumber(f.max_balance)?d.isNumber(f.max_30day_losses)?d.isNumber(f.max_turnover)?d.isNumber(f.max_30day_turnover)?d.isNumber(f.max_7day_losses)?d.isNumber(f.max_losses)?d.isNumber(f.max_7day_turnover)?void c.send(f).then(function(){a.growl.notice({message:"Your changes have been updated"})})["catch"](function(b){a.growl.error({message:b.message})}):void a.growl.error({message:"Number only for Maximum aggregate contract purchases over a 7-day period"}):void a.growl.error({message:"Number only for Maximum aggregate loss per day"}):void a.growl.error({message:"Number only for Maximum aggregate contract purchases over a 7-day period"}):void a.growl.error({message:"Number only for Maximum aggregate contract purchases over a 30-day period"}):void a.growl.error({message:"Number only for Maximum aggregate contract purchases per day"}):void a.growl.error({message:"Number only for Maximum aggregate loss over a 30-day period"}):void a.growl.error({message:"Number only for Maximum account cash balance"}):void a.growl.error({message:"Number only for Maximum number of open positions"}):void a.growl.error({message:"Number only for Session duration limit"})}},h=function(){return require(["css!selfexclusion/selfexclusion.css"]),new Promise(function(c){require(["text!selfexclusion/selfexclusion.html"],function(d){var h=a(d);f=b.createBlankWindow(a("<div/>"),{title:"Self-Exclusion Facilities",width:700,minHeight:90,"data-authorized":"true",destroy:function(){f=null}}),h.appendTo(f),e.bind(h[0],g),i(),c()})})},i=function(){a.growl.notice({message:"Refreshing settings!"}),c.send({get_self_exclusion:1}).then(function(a){a.get_self_exclusion&&(g.max_balance=a.get_self_exclusion.max_balance,g.max_turnover=a.get_self_exclusion.max_turnover,g.max_losses=a.get_self_exclusion.max_losses,g.max_7day_turnover=a.get_self_exclusion.max_7day_turnover,g.max_7day_losses=a.get_self_exclusion.max_7day_losses,g.max_30day_turnover=a.get_self_exclusion.max_30day_turnover,g.max_30day_losses=a.get_self_exclusion.max_30day_losses,g.max_open_bets=a.get_self_exclusion.max_open_bets,g.session_duration_limit=a.get_self_exclusion.session_duration_limit,g.exclude_until=a.get_self_exclusion.exclude_until)})["catch"](function(b){a.growl.error({message:b.message})})};return{init:function(a){a.click(function(){c.cached.authorize().then(function(){f?(i(),f.moveToTop()):h().then(function(){f.dialog("open")})})["catch"](function(a){})})}}});