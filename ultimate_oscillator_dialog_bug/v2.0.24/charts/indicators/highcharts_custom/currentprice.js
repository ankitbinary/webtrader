define(["common/util","highstock"],function(){var a={};return{init:function(){!function(b,c){function d(){if(this.options&&this.options.name&&-1==this.options.name.indexOf("CurrentPrice")){var b=this,d=b.options.data[b.data.length-1],f=this.yAxis;return c.each(f.plotLinesAndBands,function(c,g){var h=g.options.id;if(h){var i=a[h.replace("CurrentPrice","")];if(i&&i.parentSeriesID==b.options.id){f.removePlotLine(h);var j=d.y||d.close||d[4]||d[1];e.call(b,h.replace("CurrentPrice",""),a[h.replace("CurrentPrice","")],j)}}}),!1}}function e(a,b,d){var e=this.chart.series.length+1,f=!1;this.data[this.data.length-1]&&(c.isNumeric(this.data[this.data.length-1].change)&&(f=!0,d=toFixed(this.data[this.data.length-1].change,2)),this.yAxis.addPlotLine({id:"CurrentPrice"+a,color:b.stroke,dashStyle:b.dashStyle,width:b.strokeWidth,value:d,zIndex:e,textAlign:"left",label:{text:d+(f?"%":""),style:{background:"#2ECC71"},x:-40,y:4,useHTML:!0}}))}b&&!b.Series.prototype.addCurrentPrice&&(b.Series.prototype.addCurrentPrice=function(b){var d=this.options.id;b=c.extend({stroke:"red",strokeWidth:1,dashStyle:"dash",parentSeriesID:d},b);var f="_"+(new Date).getTime(),g=this.data||[];if(g&&g.length>0){a[f]=b;var h=g[g.length-1],i=h.y||h.close||h[4];i>0&&e.call(this,f,b,i)}return f},b.Series.prototype.removeCurrentPrice=function(b){a[b]=null,this.yAxis.removePlotLine("CurrentPrice"+b)},b.wrap(b.Series.prototype,"addPoint",function(a,b,c,e,f){a.call(this,b,c,e,f),d.call(this,b[0])}),b.wrap(b.Point.prototype,"update",function(a,b,c,e){a.call(this,b,c,e);var f=this.series;d.call(f,this.x,!0)}))}(Highcharts,jQuery)},getCurrentPriceOptions:function(){return a}}});